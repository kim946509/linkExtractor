# ADR-0001: Node.js 기반 웹 파싱 서버 분리

**제목**: 웹 콘텐츠 파싱을 위한 별도 Node.js 서버 도입

**날짜**: 2025-09-28

**상태**: Accepted

**작성자**: Backend Architect

**검토자**: Engineering Team

## 📋 컨텍스트

### 현재 상황
- LinkRadio는 웹 링크에서 텍스트 콘텐츠를 추출해야 함
- 현대 웹사이트들은 JavaScript로 동적 렌더링되는 콘텐츠가 많음
- Spring Boot(Java) 환경에서 JavaScript 렌더링과 DOM 파싱이 복잡함
- 팀에 Node.js와 웹 스크래핑 경험이 있는 개발자 존재

### 문제 정의
1. **동적 콘텐츠 처리**: SPA, AJAX 로딩 콘텐츠 파싱 어려움
2. **파싱 라이브러리 제한**: Java 생태계의 웹 파싱 도구 한계
3. **브라우저 렌더링**: JavaScript 실행이 필요한 페이지 처리 불가
4. **유지보수성**: 복잡한 파싱 로직이 메인 애플리케이션과 혼재

## 🎯 결정 사항

**Node.js + Express.js 기반의 별도 웹 파싱 서버를 구축하여 Spring Boot 메인 서버와 HTTP API로 통신**

- **기술 스택**: Node.js 18 + Express.js + Readability.js + Puppeteer
- **통신 방식**: RESTful API (HTTP/JSON)
- **배포**: 별도 컨테이너로 독립 배포
- **확장**: 큐 기반 비동기 처리 지원

## 🔍 고려된 옵션들

### 옵션 1: Spring Boot 내 Java 파싱 라이브러리 사용
**설명**: JSoup, HtmlUnit 등 Java 기반 라이브러리 활용

**장점**:
- ✅ 단일 애플리케이션으로 배포 단순화
- ✅ 기존 Spring Boot 환경과 완전 통합
- ✅ 팀의 Java 경험 활용 가능

**단점**:
- ❌ JavaScript 렌더링 콘텐츠 처리 제한
- ❌ 제한적인 파싱 라이브러리 생태계
- ❌ 동적 웹사이트 파싱 성공률 낮음 (예상 60%)
- ❌ 복잡한 웹사이트 구조 변경 대응 어려움

**비용**: 구현 비용 낮음, 운영 비용 중간, 학습 비용 낮음

### 옵션 2: 외부 파싱 서비스 (Mercury Parser, Diffbot)
**설명**: 서드파티 웹 콘텐츠 추출 API 서비스 활용

**장점**:
- ✅ 높은 파싱 성공률 (90%+)
- ✅ 구현 복잡도 낮음
- ✅ 지속적인 웹사이트 대응 업데이트

**단점**:
- ❌ 높은 운영 비용 (요청당 과금)
- ❌ 외부 서비스 의존성으로 인한 가용성 리스크
- ❌ 데이터 보안 및 프라이버시 우려
- ❌ 커스터마이징 제한

**비용**: 구현 비용 낮음, 운영 비용 매우 높음, 학습 비용 낮음

### 옵션 3: Node.js 파싱 서버 (선택됨)
**설명**: Node.js + Readability.js + Puppeteer로 전용 파싱 서버 구축

**장점**:
- ✅ JavaScript 렌더링 완벽 지원 (Puppeteer)
- ✅ 우수한 파싱 라이브러리 생태계 (Readability.js)
- ✅ 높은 파싱 성공률 (90%+) 기대
- ✅ 유연한 커스터마이징 가능
- ✅ 비용 효율적 (자체 운영)
- ✅ 마이크로서비스 아키텍처로 확장성 확보

**단점**:
- ❌ 추가적인 서비스 운영 복잡도
- ❌ Node.js 런타임 환경 추가 필요
- ❌ 서비스 간 네트워크 지연

**비용**: 구현 비용 중간, 운영 비용 낮음, 학습 비용 중간

## ⚖️ 결정 근거

### 주요 평가 기준
1. **파싱 성공률**: 비즈니스 성공의 핵심 지표
2. **운영 비용**: 스타트업의 비용 효율성 중요
3. **확장성**: 향후 마이크로서비스 전환 대비
4. **기술 적합성**: 웹 파싱에 최적화된 기술 스택
5. **팀 역량**: 기존 팀의 Node.js 경험 활용
6. **커스터마이징**: 특화된 파싱 로직 구현 필요

### 결정 매트릭스

| 기준 | 가중치 | Java 라이브러리 | 외부 서비스 | Node.js 서버 |
|------|--------|-----------------|-------------|--------------|
| 파싱 성공률 | 30% | 6 | 9 | 9 |
| 운영 비용 | 25% | 8 | 3 | 8 |
| 확장성 | 20% | 6 | 4 | 9 |
| 커스터마이징 | 15% | 7 | 3 | 9 |
| 팀 역량 | 10% | 9 | 8 | 7 |
| **총점** | **100%** | **6.75** | **5.45** | **8.55** |

### 최종 결정 이유
1. **파싱 성공률 극대화**: Readability.js + Puppeteer 조합으로 90% 이상 성공률 기대
2. **비용 효율성**: 외부 서비스 대비 운영 비용 절약 (월 $500+ 절약)
3. **기술적 적합성**: 웹 파싱에 최적화된 Node.js 생태계 활용

## 📈 예상 결과

### 긍정적 영향
- **높은 파싱 성공률**: 90% 이상의 웹사이트에서 성공적인 콘텐츠 추출
- **동적 콘텐츠 지원**: JavaScript 렌더링 페이지 완벽 지원
- **비용 절약**: 외부 서비스 대비 월 $500+ 운영비 절약
- **확장성 확보**: 독립적인 스케일링 및 향후 마이크로서비스 기반 마련

### 부정적 영향/트레이드오프
- **운영 복잡도 증가**: 2개 서비스 운영 및 모니터링 필요
- **네트워크 지연**: 서비스 간 HTTP 통신으로 인한 50-100ms 추가 지연
- **개발 복잡도**: 2개 언어/프레임워크 유지보수

### 리스크와 완화 방안
| 리스크 | 확률 | 영향도 | 완화 방안 |
|--------|------|--------|-----------|
| Node.js 서버 장애 | Medium | High | Health check, 자동 재시작, 다중 인스턴스 |
| 메모리 누수 (Puppeteer) | Medium | Medium | 브라우저 인스턴스 풀링, 정기 재시작 |
| 파싱 성능 저하 | Low | Medium | 캐싱 전략, 큐 기반 비동기 처리 |

## 🛠️ 구현 계획

### 단계별 구현
1. **Phase 1** (1 week): 기본 Node.js 서버 및 Readability.js 통합
2. **Phase 2** (1 week): Puppeteer 통합 및 동적 렌더링 지원
3. **Phase 3** (1 week): Spring Boot 통합 및 테스트
4. **Phase 4** (1 week): 성능 최적화 및 캐싱

### 필요한 리소스
- **인력**: Backend Developer 1명 (4주)
- **기술**: Node.js, Docker, AWS ECS
- **인프라**: 추가 컨테이너 인스턴스 (t3.medium x2)

### 성공 지표
- 파싱 성공률 90% 이상 달성
- 평균 파싱 시간 30초 이내
- 99.5% 가용성 유지

## 🔄 검토 및 모니터링

### 검토 일정
- **1개월 후**: 파싱 성공률 및 성능 평가
- **3개월 후**: 운영 안정성 및 비용 분석
- **6개월 후**: 마이크로서비스 전환 계획 수립

### 모니터링 지표
- 파싱 성공률 (목표: >90%)
- 평균 응답 시간 (목표: <30초)
- 서버 리소스 사용률 (CPU, Memory)
- 에러율 (목표: <5%)

### 재검토 트리거
- 파싱 성공률 85% 미만 지속
- 평균 응답 시간 60초 초과
- 운영 비용이 외부 서비스와 동등해질 때

## 📚 참고 자료

### 관련 문서
- [LinkRadio System Overview](../system-overview.md)
- [Container Diagram](../c4-model/container-diagram.md)

### 외부 리소스
- [Mozilla Readability.js](https://github.com/mozilla/readability)
- [Puppeteer Documentation](https://pptr.dev/)
- [Web Scraping Best Practices](https://blog.apify.com/web-scraping-best-practices/)

## 💬 논의 기록

### 주요 논의 사항
- **2025-09-27**: 외부 서비스 vs 자체 구축 비용 분석
- **2025-09-28**: 팀 역량 및 기술 스택 적합성 논의

### 이의 제기 및 응답
- **DevOps Engineer**: "운영 복잡도 증가 우려"
  - **응답**: Docker 컨테이너화 및 자동화된 배포 파이프라인으로 복잡도 최소화

### 추가 고려사항
- 향후 AI 기반 콘텐츠 요약 기능 추가 시 Node.js 서버 확장 고려
- 다국어 콘텐츠 파싱 지원 계획

---

**변경 이력**:
- v1.0 (2025-09-28): 초기 작성 및 승인

**관련 ADR**:
- ADR-0002: 데이터베이스 선택 (계획)
- ADR-0003: TTS 서비스 프로바이더 선택 (계획)