# ADR-0002: Gemini + Google TTS + Sentry 통합 스택 채택

**제목**: AI 텍스트 개선, TTS, 모니터링을 위한 Google/Sentry 통합 스택 도입

**날짜**: 2025-09-28

**상태**: Accepted

**작성자**: Backend Architect

**검토자**: Engineering Team

## 📋 컨텍스트

### 현재 상황
- LinkRadio는 웹 콘텐츠를 음성으로 변환하는 핵심 기능 구현 필요
- 추출된 원본 텍스트는 음성 변환에 최적화되지 않은 상태
- 스타트업 예산으로 무료/저비용 서비스 우선 고려
- 에러 추적 및 성능 모니터링 시스템 필요
- 우분투 서버 + Docker 환경으로 배포 방식 결정

### 문제 정의
1. **텍스트 품질**: 웹에서 추출한 원본 텍스트는 음성 변환에 부적합 (광고, 링크, 불필요한 구문 포함)
2. **TTS 서비스 선택**: 품질 좋은 한국어 TTS를 저비용으로 제공하는 서비스 필요
3. **모니터링 부재**: 에러 추적, 성능 모니터링, 사용자 경험 개선을 위한 관찰성 도구 필요
4. **비용 최적화**: MVP 단계에서 운영 비용 최소화 필요

## 🎯 결정 사항

**Google Gemini API + Google Cloud TTS + Sentry 모니터링을 통합한 AI 기반 콘텐츠 처리 파이프라인 구축**

### 핵심 구성 요소:
1. **Google Gemini API**: 추출된 텍스트를 음성 변환에 최적화
2. **Google Cloud TTS**: 고품질 한국어 음성 변환 (월 100만 글자 무료)
3. **Sentry**: 에러 추적 및 성능 모니터링
4. **로컬 파일 저장**: 우분투 서버의 로컬 스토리지 활용

## 🔍 고려된 옵션들

### 옵션 1: AWS 생태계 (Bedrock + Polly + CloudWatch)
**설명**: AWS Claude + Amazon Polly + CloudWatch 조합

**장점**:
- ✅ 완전한 AWS 통합 환경
- ✅ Polly의 풍부한 음성 옵션
- ✅ 월 500만 글자 무료 (12개월)

**단점**:
- ❌ Bedrock 비용 높음 (토큰당 과금)
- ❌ 12개월 후 Polly 유료 전환
- ❌ CloudWatch 복잡성 및 비용
- ❌ 우분투 서버 환경과 AWS 종속성 불일치

**비용**: 구현 비용 중간, 운영 비용 높음 (장기), 학습 비용 높음

### 옵션 2: 오픈소스 TTS + 로컬 AI 모델
**설명**: Coqui TTS + Local LLM (Llama) + 자체 모니터링

**장점**:
- ✅ 완전 무료
- ✅ 데이터 프라이버시 보장
- ✅ 커스터마이징 자유도 높음

**단점**:
- ❌ 높은 서버 리소스 요구 (GPU 필요)
- ❌ 한국어 모델 품질 제한
- ❌ 복잡한 설정 및 유지보수
- ❌ 모니터링 시스템 자체 구축 필요

**비용**: 구현 비용 매우 높음, 운영 비용 낮음, 학습 비용 매우 높음

### 옵션 3: Google 생태계 + Sentry (선택됨)
**설명**: Gemini + Google Cloud TTS + Sentry 모니터링

**장점**:
- ✅ Gemini API 텍스트 개선으로 TTS 품질 향상
- ✅ Google TTS 월 100만 글자 무료, 뛰어난 한국어 품질
- ✅ Sentry 무료 플랜으로 충분한 모니터링
- ✅ Google 생태계 통합으로 API 일관성
- ✅ 우분투 서버에서 간단한 통합

**단점**:
- ❌ Google 서비스 종속성
- ❌ Gemini API 초기 비용 (무료 할당량 후)
- ❌ 네트워크 지연 (외부 API 호출)

**비용**: 구현 비용 중간, 운영 비용 낮음 (초기), 학습 비용 중간

## ⚖️ 결정 근거

### 주요 평가 기준
1. **비용 효율성**: MVP 단계 무료/저비용 우선
2. **음성 품질**: 한국어 TTS 품질이 사용자 경험의 핵심
3. **개발 속도**: 빠른 MVP 출시를 위한 구현 복잡도
4. **모니터링**: 사용자 피드백과 시스템 안정성 확보
5. **확장성**: 향후 유료 플랜으로 확장 용이성
6. **팀 역량**: 기존 팀의 Google Cloud 경험

### 결정 매트릭스

| 기준 | 가중치 | AWS 생태계 | 오픈소스 | Google + Sentry |
|------|--------|------------|----------|-----------------|
| 비용 효율성 | 30% | 6 | 9 | 8 |
| 음성 품질 | 25% | 8 | 5 | 9 |
| 개발 속도 | 20% | 7 | 3 | 9 |
| 모니터링 | 15% | 8 | 4 | 9 |
| 확장성 | 10% | 9 | 6 | 8 |
| **총점** | **100%** | **7.05** | **5.85** | **8.55** |

### 최종 결정 이유
1. **텍스트 품질 혁신**: Gemini API로 음성에 최적화된 텍스트 생성
2. **비용 대비 품질**: Google TTS의 뛰어난 한국어 품질과 무료 할당량
3. **운영 안정성**: Sentry를 통한 프로액티브 모니터링

## 📈 예상 결과

### 긍정적 영향
- **향상된 음성 품질**: AI 개선된 텍스트로 자연스러운 TTS 결과
- **비용 절약**: 월 200개 기사 무료 처리 (100만 글자 할당량)
- **빠른 문제 해결**: Sentry를 통한 실시간 에러 감지 및 해결
- **사용자 경험 개선**: 고품질 한국어 음성과 안정적인 서비스

### 부정적 영향/트레이드오프
- **외부 의존성**: Google 서비스 장애 시 영향
- **네트워크 지연**: API 호출로 인한 처리 시간 증가 (예상 5-10초)
- **할당량 제한**: 무료 할당량 초과 시 비용 발생

### 리스크와 완화 방안
| 리스크 | 확률 | 영향도 | 완화 방안 |
|--------|------|--------|-----------|
| Google API 장애 | Low | High | 캐싱 전략, 다중 제공자 준비 |
| 할당량 초과 | Medium | Medium | 사용량 모니터링, 캐싱으로 중복 요청 방지 |
| 텍스트 개선 품질 | Low | Medium | Gemini 프롬프트 최적화, 품질 검증 |

## 🛠️ 구현 계획

### 단계별 구현
1. **Phase 1** (1 week): Google Cloud TTS 기본 통합
2. **Phase 2** (1 week): Gemini API 텍스트 개선 파이프라인 구축
3. **Phase 3** (3 days): Sentry 모니터링 통합
4. **Phase 4** (2 days): 캐싱 및 성능 최적화

### 필요한 리소스
- **인력**: Node.js Developer 1명 (2.5주)
- **API 키**: Google Cloud Platform 계정, Sentry 계정
- **인프라**: 우분투 서버 디스크 공간 (오디오 파일 저장)

### 성공 지표
- TTS 변환 성공률 95% 이상
- 평균 처리 시간 30초 이내 (AI 개선 + TTS 포함)
- Sentry를 통한 에러 감지 5분 이내

## 🔄 검토 및 모니터링

### 검토 일정
- **2주 후**: Gemini 텍스트 개선 품질 평가
- **1개월 후**: TTS 품질 및 사용자 만족도 조사
- **3개월 후**: 비용 및 할당량 사용량 분석

### 모니터링 지표
- **Gemini API**: 응답 시간, 토큰 사용량, 에러율
- **Google TTS**: 변환 성공률, 오디오 품질, 글자 수 사용량
- **Sentry**: 에러 발생 빈도, 성능 지표, 사용자 세션

### 재검토 트리거
- 월 할당량 80% 도달 시 비용 최적화 검토
- TTS 품질 만족도 80% 미만 시 대안 검토
- Gemini API 비용이 월 $50 초과 시 최적화 계획 수립

## 📚 참고 자료

### 관련 문서
- [ADR-0001: Node.js 파싱 서버](./0001-nodejs-parsing-server.md)
- [System Overview](../system-overview.md)

### 외부 리소스
- [Google Gemini API Documentation](https://ai.google.dev/docs)
- [Google Cloud Text-to-Speech Pricing](https://cloud.google.com/text-to-speech/pricing)
- [Sentry Performance Monitoring](https://docs.sentry.io/product/performance/)

### 기술 가이드
- [Node.js Google Cloud TTS Integration](https://cloud.google.com/text-to-speech/docs/libraries)
- [Sentry Node.js SDK](https://docs.sentry.io/platforms/node/)

## 💬 논의 기록

### 주요 논의 사항
- **2025-09-28**: TTS 품질 vs 비용 트레이드오프 분석
- **2025-09-28**: Gemini를 통한 텍스트 개선 효과 검증 계획 수립

### 이의 제기 및 응답
- **DevOps Engineer**: "외부 API 의존성으로 인한 지연 우려"
  - **응답**: 캐싱 전략과 비동기 처리로 사용자 경험 최적화. 30초 이내 처리 목표

### 추가 고려사항
- 향후 Enterprise 고객을 위한 온프레미스 TTS 옵션 검토
- 다국어 지원 확장 시 Google TTS의 언어별 품질 평가

---

**변경 이력**:
- v1.0 (2025-09-28): 초기 작성 및 승인

**관련 ADR**:
- ADR-0001: Node.js 기반 웹 파싱 서버 분리
- ADR-0003: 우분투 서버 배포 전략 (계획)